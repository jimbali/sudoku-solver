"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const types_1 = require("../../types");
const house_1 = require("../house");
const remeda_1 = require("remeda");
/**
 * Resolve the list of candidates that can be placed in a cell according to the digits that have been placed in the same
 * houses.
 *
 * @private
 * @since 0.0.1
 *
 * @param {ReadonlyMap<GridIndex, Digit>} digits The list of all the digits placed in the grid.
 * @param {GridIndex} index The index of the cell in the grid.
 * @returns {Pencilmarks | undefined} The list of candidates that can be placed in the cell; otherwise, if the cell
 * already has a digit placed, `undefined`.
 *
 * @example
 * const grid = parseGrid(`
 *   .23......
 *   456......
 *   789......
 *   .........
 *   .........
 *   .........
 *   .........
 *   .........
 *   .........
 * `);
 *
 * getCandidatesForCell(grid.digits, 0);
 * // => [1]
 * getCandidatesForCell(grid.digits, 1);
 * // => undefined
 * getCandidatesForCell(grid.digits, 3);
 * // => [1, 4, 5, 6, 7, 8, 9]
 * getCandidatesForCell(grid.digits, 80);
 * // => [1, 2, 3, 4, 5, 6, 7, 8, 9]
 */
function getCandidatesForCell(digits, index) {
    if (digits.has(index)) {
        return;
    }
    else {
        const candidates = remeda_1.pipe(house_1.getCellHouses(index), remeda_1.flatMap((house) => remeda_1.map(house.cells, (cell) => digits.get(cell))), remeda_1.compact);
        return remeda_1.difference(types_1.VALID_DIGITS, candidates);
    }
}
exports.getCandidatesForCell = getCandidatesForCell;
/**
 * Determine all the candidates that can be placed in the empty cells of a grid.
 *
 * @private
 * @since 0.0.1
 *
 * @param {ReadonlyMap<GridIndex, Digit>} digits The list of all the digits placed in the grid.
 * @returns {Pencilmarks | undefined} A list containing all the candidates that can be placed in the empty cells of the
 * grid.
 *
 * @example
 * const grid = parseGrid(`
 *   +---+---+---+
 *   |.71|263|584|
 *   |345|798|126|
 *   |268|.45|937|
 *   +---+---+---+
 *   |437|519|862|
 *   |156|824|793|
 *   |892|376|451|
 *   +---+---+---+
 *   |713|952|648|
 *   |584|631|279|
 *   |629|487|315|
 *   +---+---+---+`);
 *
 * getCandidates(grid.digits);
 * // => [[0, 9], [21, 1]]
 */
function getCandidates(digits) {
    return new Map(remeda_1.pipe(types_1.VALID_GRID_INDEXES, remeda_1.filter((index) => !digits.has(index)), remeda_1.map((index) => [index, getCandidatesForCell(digits, index)])));
}
exports.getCandidates = getCandidates;
